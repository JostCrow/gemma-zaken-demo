{% extends "demo/base.html" %}

{% block extra_style %}
  {{ block.super }}

  <style>
    #map-canvas { height: 600px; }
  </style>
{% endblock %}

{% block content %}

  <div class="container">

    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}

      <div class="row">
        <div class="col-sm">
          <label class="required">Locatie</label>
          <div id="map-canvas"></div>
        </div>
        <div class="col-sm">
          {% include "includes/form_fields.html" %}
          <button type="submit" class="btn btn-primary">Melding indienen</button>
        </div>
      </div>

    </form>

  </div>

{% endblock %}

{% block extra_scripts %}
<script type="application/javascript">

function initMap() {
  var mapDiv = document.getElementById('map-canvas');
  var map = new google.maps.Map(mapDiv, {
    center: new google.maps.LatLng(52.36991896035238, 4.897787135976614),
    zoom: 15,
    mapTypeId: google.maps.MapTypeId.ROADMAP,
    styles: [
      {
        featureType: 'poi.business',
        stylers: [{visibility: 'off'}]
      },
      {
        featureType: 'transit',
        elementType: 'labels.icon',
        stylers: [{visibility: 'off'}]
      }
    ]
  });
  var geocoder = new google.maps.Geocoder;
  // var infowindow = new google.maps.InfoWindow;
  var marker = new google.maps.Marker({map: map});

  google.maps.event.addListener(map, 'click', function(args) {
    var latlng = args.latLng;

    console.log( latlng.lat() + ', ' + latlng.lng() );

    $('#id_latitude').val(latlng.lat());
    $('#id_longitude').val(latlng.lng());

    geocoder.geocode({'location': latlng}, function(results, status) {
      if (status === 'OK') {
        if (results[0]) {
          marker.setPosition(latlng);

          // infowindow.setContent(results[0].formatted_address);
          // infowindow.open(map, marker);

          $('#id_adres').val(results[0].formatted_address);
        } else {
          window.alert('No results found');
        }
      } else {
        window.alert('Geocoder failed due to: ' + status);
      }
    });

  });

}

// google.maps.event.addDomListener(window, 'load', initialize);
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDeWnY3S_RZ8rSVhiTEd3n9_R1RY4ashdM&callback=initMap" async defer></script>
{% endblock %}